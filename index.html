<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Smart Home 4CH</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body{font-family:sans-serif;background:#eef2f5;text-align:center}
.card{background:#fff;padding:15px;margin:10px auto;max-width:420px;border-radius:12px}
button{padding:6px 12px;margin:4px;border:none;border-radius:8px;font-weight:bold}
.on{background:#28a745;color:#fff}
.off{background:#dc3545;color:#fff}
.auto{background:#007bff;color:#fff}
input[type=time]{padding:4px}
</style>
</head>

<body>
<h2>Smart Home 4CH</h2>
<div id="panel"></div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCpm-ASXEoZNI09ehc8YF3MIk_4yxXvXbI",
  databaseURL:"https://home-front-light-default-rtdb.asia-southeast1.firebasedatabase.app/"
});
const db = firebase.database();
const names=["ห้องนั่งเล่น","ห้องนอน","ห้องครัว","รั้วหน้าบ้าน"];
const panel=document.getElementById("panel");

for(let i=1;i<=4;i++){
  panel.innerHTML+=`
  <div class="card">
    <h3>${names[i-1]}</h3>
    <button class="on" onclick="manual(${i},1)">เปิด</button>
    <button class="off" onclick="manual(${i},0)">ปิด</button>
    <button class="auto" onclick="auto(${i})">Auto</button>

    <div>รอบ1 เปิด <input type="time" id="on1_${i}">
         ปิด <input type="time" id="off1_${i}"></div>
    <div>รอบ2 เปิด <input type="time" id="on2_${i}">
         ปิด <input type="time" id="off2_${i}"></div>

    <button onclick="saveTime(${i})">บันทึกเวลา</button>
    <div id="st${i}">---</div>
  </div>`;
}

function manual(i,val){
  db.ref(`controls/sw${i}`).update({mode:"manual",state:val});
}
function auto(i){
  db.ref(`controls/sw${i}/mode`).set("auto");
}
function saveTime(i){
  db.ref(`controls/sw${i}`).update({
    on1:document.getElementById(`on1_${i}`).value||"",
    off1:document.getElementById(`off1_${i}`).value||"",
    on2:document.getElementById(`on2_${i}`).value||"",
    off2:document.getElementById(`off2_${i}`).value||""
  });
}

db.ref("controls").on("value",snap=>{
  const d=snap.val(); if(!d) return;
  for(let i=1;i<=4;i++){
    const sw=d["sw"+i]; if(!sw) continue;
    on1_${i}.value=sw.on1||""; off1_${i}.value=sw.off1||"";
    on2_${i}.value=sw.on2||""; off2_${i}.value=sw.off2||"";
    st${i}.innerText= sw.mode==="auto" ? "AUTO ⏰" : (sw.state?"เปิดอยู่":"ปิดอยู่");
  }
});
</script>
</body>
</html>
